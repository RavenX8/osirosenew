CMAKE_MINIMUM_REQUIRED(VERSION 2.8 FATAL_ERROR)
PROJECT(src)

IF(ENABLE_TESTING AND ENABLE_TESTING_COVERAGE)
    SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -g -fprofile-arcs -ftest-coverage")
	
find_package(ProtocolBuffer REQUIRED)

INCLUDE_DIRECTORIES(
    SYSTEM ${GTEST_INCLUDE_DIR}
    SYSTEM ${GMOCK_INCLUDE_DIR}
)
ENDIF() # ENABLE_TESTING_COVERAGE

IF( ENABLE_ASAN )
	SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -g -fsanitize=address -fno-omit-frame-pointer")
	SET(LINK_FLAGS "${LINK_FLAGS} -g -fsanitize=address")
ENDIF()

IF( DISABLE_CRYPT )
    SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -DDISABLE_CRYPT")
ENDIF()

INCLUDE_DIRECTORIES(
    SYSTEM ${PROTOBUF_INCLUDE_DIR}
    SYSTEM ${ASIO_INCLUDE_DIR}
    SYSTEM ${EXTERNAL_INCLUDE_DIR}
    SYSTEM ${PBJSON_ROOT}
    SYSTEM ${SPDLOG_ROOT}
	SYSTEM ${SELENE_ROOT}
	SYSTEM ${SOL2_ROOT}
	SYSTEM ${LUA_INCLUDE_DIR}
)

LINK_DIRECTORIES(
	${EXTERNAL_BINARY_DIR}
)

IF(ENABLE_MYSQL)
  INCLUDE_DIRECTORIES(
      SYSTEM ${MYSQL_INCLUDE_DIRS}
      SYSTEM ${MYSQLpp_INCLUDE_DIR}
  )
  
  LINK_DIRECTORIES(
	  ${MYSQL_LIBRARY_PATH}
	  ${MYSQLpp_LIBRARY_PATH}
  )
ENDIF()

#this is a temp fix for windows builds
SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -DWIN32_LEAN_AND_MEAN")

ADD_SUBDIRECTORY(proto)
ADD_SUBDIRECTORY(core)
ADD_SUBDIRECTORY(rosecommon)
ADD_SUBDIRECTORY(login)
ADD_SUBDIRECTORY(char)
ADD_SUBDIRECTORY(map)

IF(ENABLE_TESTING)
    ADD_SUBDIRECTORY(tests)
ENDIF()

